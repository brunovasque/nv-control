<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>NV-Control | ENAVIA</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="app">
      <!-- HEADER -->
      <header class="app-header">
        <div class="app-header-left">
          <h1>NV-Control</h1>
          <p class="subtitle">Painel de supervisão da ENAVIA</p>
        </div>
        <div class="app-header-right">
          <div class="worker-url">
            <label for="workerUrlInput">Worker:</label>
            <input
              id="workerUrlInput"
              type="text"
              spellcheck="false"
              value="https://nv-enavia.brunovasque.workers.dev"
            />
          </div>
          <div class="badges">
            <span id="status-badge" class="badge badge-neutral">Pronto</span>
            <span
              id="mode-badge"
              class="badge badge-mode badge-mode-director"
            >
              DIRECTOR
            </span>
          </div>
        </div>
      </header>

      <!-- MAIN -->
      <main class="app-main">
        <!-- LEFT: CONSOLE -->
        <section class="console">
          <div class="console-header">
            <span>Console NV-Control</span>
          </div>

          <div id="messages" class="messages"></div>

          <div class="input-area">
            <textarea
              id="userInput"
              rows="3"
              placeholder="Digite sua mensagem... (Enter envia, Ctrl+Enter quebra linha)"
            ></textarea>
            <div class="input-toolbar">
              <div class="mode-buttons">
                <!-- MODOS PRINCIPAIS -->
              <button
                id="deployTestBtn"
                type="button"
                class="btn btn-icon deploy-btn deploy-btn-warn"
                title="Executa o deploy REAL no ambiente TESTE (após simulação/aceite)"
              >
                Deploy TESTE
              </button>

              <button
                id="cancelCycleBtn"
                type="button"
                class="btn btn-icon deploy-btn deploy-btn-danger"
                title="Cancelar ciclo atual (descartar staging/sugestão pendente)"
              >
                Cancelar
              </button>

              
                <button
                  id="modeDirectorBtn"
                  type="button"
                  class="btn btn-secondary btn-mode active"
                >
                  Director
                </button>
                <button
                  id="modeEnaviaBtn"
                  type="button"
                  class="btn btn-secondary btn-mode"
                >
                  Enavia
                </button>
                <button
                  id="modeEngineerBtn"
                  type="button"
                  class="btn btn-secondary btn-mode"
                >
                  Engineer
                </button>
                <button
                  id="modeBrainBtn"
                  type="button"
                  class="btn btn-secondary btn-mode"
                >
                  Brain
                </button>
              </div>
              <div class="send-area">
                <label class="checkbox-inline">
                  <input id="debugToggle" type="checkbox" checked />
                  <span>Debug</span>
                </label>
                <button id="sendBtn" type="button" class="btn btn-primary">
                  Enviar
                </button>
              </div>
            </div>

            <!-- BARRA DE DEPLOY -->
            <div class="deploy-toolbar">
              <button
                id="deploySimulateBtn"
                type="button"
                class="btn btn-icon deploy-btn deploy-btn-simulate"
                title="Simular deploy (sem aplicar mudanças)"
              >
                Simulate
              </button>

              <button
                id="deployApplyUserPatchBtn"
                type="button"
                class="btn btn-icon deploy-btn deploy-btn-apply"
                title="Aplicar patch escrito por você no ENAVIA_GIT"
              >
                Apply Patch
              </button>

              <button
                id="deployAcceptSuggestionBtn"
                type="button"
                class="btn btn-icon deploy-btn deploy-btn-suggestion"
                title="Aceitar e aplicar a última sugestão da ENAVIA"
              >
                Accept Suggestion
              </button>

              <button
                id="deployWorkerBtn"
                type="button"
                class="btn btn-icon deploy-btn deploy-btn-worker"
                title="Deploy direto para o Worker NV-ENAVIA"
              >
                Deploy Worker
              </button>

              <button
                id="deploySafeBtn"
                type="button"
                class="btn btn-icon deploy-btn deploy-btn-safe"
                title="Deploy supervisionado (staging + validações)"
              >
                Safe Deploy
              </button>

              <button
                id="deployRollbackBtn"
                type="button"
                class="btn btn-icon deploy-btn deploy-btn-rollback"
                title="Rollback para último estado estável"
              >
                Rollback
              </button>

              <button
                id="deploySessionCloseBtn"
                type="button"
                class="btn btn-icon deploy-btn deploy-btn-close"
                title="Encerrar / cancelar sessão de deploy"
              >
                Close Deploy
              </button>
            </div>
          </div>
        </section>

        <!-- RIGHT: TELEMETRIA / EXECUÇÃO / HISTÓRICO / AVANÇADO -->
        <section class="side-panel">
          <div class="tabs">
            <button
              id="tab-telemetry"
              class="tab active"
              data-tab="telemetry"
            >
              Telemetria
            </button>
            <button id="tab-run" class="tab" data-tab="run">
              Execução
            </button>
            <button id="tab-history" class="tab" data-tab="history">
              Histórico
            </button>
            <button id="tab-advanced" class="tab" data-tab="advanced">
              Avançado
            </button>
          </div>

          <div class="tab-panels">
            <!-- TELEMETRIA -->
            <div id="panel-telemetry" class="tab-panel active">
              <div class="card">
                <div class="card-header">
                  <span>Resumo</span>
                  <span class="card-badge" id="telemetry-summary-badge"
                    >-</span
                  >
                </div>
                <div id="telemetry-summary" class="card-body card-grid"></div>
              </div>

              <div class="card">
                <div class="card-header">
                  <span>Request</span>
                  <button
                    type="button"
                    class="btn-icon copy-btn"
                    data-copy-target="telemetry-request"
                    title="Copiar JSON do request"
                  >
                    Copiar
                  </button>
                </div>
                <pre id="telemetry-request" class="card-body code-block"></pre>
              </div>

              <div class="card">
                <div class="card-header">
                  <span>Response</span>
                  <button
                    type="button"
                    class="btn-icon copy-btn"
                    data-copy-target="telemetry-response"
                    title="Copiar JSON da response"
                  >
                    Copiar
                  </button>
                </div>
                <pre id="telemetry-response" class="card-body code-block"></pre>
              </div>

              <div class="card" id="telemetry-error-card" style="display:none;">
                <div class="card-header">
                  <span>Erro</span>
                  <button
                    type="button"
                    class="btn-icon copy-btn"
                    data-copy-target="telemetry-error"
                    title="Copiar detalhes de erro"
                  >
                    Copiar
                  </button>
                </div>
                <pre id="telemetry-error" class="card-body code-block"></pre>
              </div>
            </div>

            <!-- EXECUÇÃO (NOVO) -->
            <div id="panel-run" class="tab-panel">
              <div class="card">
                <div class="card-header">
                  <span>Execução da ENAVIA</span>
                  <div class="header-actions">
                    <button
                      type="button"
                      id="clearRunLogBtn"
                      class="btn-icon"
                      title="Limpar execução"
                    >
                      Limpar
                    </button>
                  </div>
                </div>
                <div id="run-log" class="run-log"></div>
              </div>
            </div>

            <!-- HISTÓRICO -->
            <div id="panel-history" class="tab-panel">
              <div class="card">
                <div class="card-header">
                  <span>Histórico de chamadas</span>

                  <div class="header-actions">
                    <select
                      id="historyModeFilter"
                      class="history-filter-select"
                      title="Filtrar histórico por modo"
                    >
                      <option value="all">All</option>
                      <option value="director">Director</option>
                      <option value="enavia">Enavia</option>
                      <option value="engineer">Engineer</option>
                      <option value="brain">Brain</option>
                      <option value="executor">Executor</option>
                    </select>

                    <button
                      type="button"
                      id="exportHistoryBtn"
                      class="btn-icon"
                      title="Exportar histórico"
                    >
                      Exportar
                    </button>

                    <button
                      type="button"
                      id="clearHistoryBtn"
                      class="btn-icon"
                      title="Limpar histórico"
                    >
                      Limpar
                    </button>
                  </div>
                </div>

                <div id="history-list" class="card-body history-list"></div>
              </div>
            </div>

            <!-- AVANÇADO -->
            <div id="panel-advanced" class="tab-panel">
              <div class="card">
                <div class="card-header">
                  <span>Raw log da última interação</span>
                  <button
                    type="button"
                    class="btn-icon copy-btn"
                    data-copy-target="advanced-raw"
                    title="Copiar log completo"
                  >
                    Copiar
                  </button>
                </div>
                <pre id="advanced-raw" class="card-body code-block"></pre>
              </div>
            </div>
          </div>
        </section>
      </main>

      <!-- FOOTER -->
      <footer class="app-footer">
        <span>NV-Control • ENAVIA supervisionada (modo <strong>supervised</strong>)</span>
        <span class="hint">
          Dica: use <strong>Director</strong> para decisão, <strong>Enavia</strong> para execução,
          <strong>Engineer</strong> para plano/patch e <strong>Brain</strong> para treinamento.
        </span>
      </footer>
    </div>

    <script src="script.js"></script>
  </body>
</html>
