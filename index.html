<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>ENAVIA ‚Äî Control Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- üö´ DESATIVA GOOGLE TRANSLATE (CR√çTICO) -->
  <meta name="google" content="notranslate" />

  <!-- CSP controlada exclusivamente via vercel.json -->

  <!-- CSS PRINCIPAL -->
  <link rel="stylesheet" href="./style.css" />
</head>

<body>

  <!-- =========================
       APP ROOT
  ========================== -->
  <div class="app-root">

    <!-- =========================
         SIDEBAR ESQUERDA
    ========================== -->
    <aside class="sidebar">

      <div class="sidebar-header">
        <div class="logo">ENAVIA</div>
        <div class="subtitle">Painel de Controle</div>
      </div>

      <!-- MODOS / CANAIS -->
      <nav class="sidebar-section">
        <div class="section-title">Modos</div>

        <button class="sidebar-btn active" data-mode="director">
          Director
        </button>

        <button class="sidebar-btn" data-mode="telemetry">
          Telemetria
        </button>

        <button class="sidebar-btn" data-mode="history">
          Hist√≥rico
        </button>

        <button class="sidebar-btn" data-mode="advanced">
          Avan√ßado
        </button>
      </nav>

      <!-- A√á√ïES -->
      <nav class="sidebar-section">
        <div class="section-title">A√ß√µes</div>

        <button class="sidebar-btn" data-action="view-director-enavia-chat">
          Visualizar conversa<br>
          Director ‚áÑ ENAVIA
        </button>

      <div class="divider"></div>

<button class="sidebar-btn mode-btn active" data-chat-mode="director">
  üß† Modo Director
</button>

<button class="sidebar-btn mode-btn" data-chat-mode="manual">
  ‚úçÔ∏è Modo Manual
</button>

      </nav>

    </aside>

    <!-- =========================
         √ÅREA PRINCIPAL
    ========================== -->
    <main class="main-area">

      <!-- =========================
           HEADER SUPERIOR
      ========================== -->
      <header class="top-bar">

        <div class="execution-info">
          <span class="label">Execution ID:</span>
          <span class="value" id="executionId">‚Äî</span>
        </div>

        <div class="status-info">
          <span class="label">Status:</span>
          <span class="status-pill neutral" id="statusPill">Aguardando</span>
        </div>

      </header>

      <!-- =========================
           CONTE√öDO CENTRAL
      ========================== -->
      <section class="content-area">

        <!-- =========================
             CHAT PRINCIPAL (DIRECTOR)
        ========================== -->
        <div class="chat-container">

          <div class="chat-messages" id="chatMessages">

            <!-- BOAS-VINDAS -->
<div class="chat-message role-director">
  <div class="chat-role">Director</div>
  <div class="chat-text">
    ENAVIA ¬∑ Director Mode

    Controle, an√°lise e decis√£o com seguran√ßa.

    Defina o objetivo ou forne√ßa o patch para an√°lise.
  </div>
</div>

</div>

<!-- INPUT -->
<div class="chat-input-container">
            <textarea
              id="chatInput"
              class="chat-input"
              placeholder="Escreva aqui‚Ä¶"
              rows="1"
            ></textarea>
            <button id="sendBtn" class="send-btn">Enviar</button>
          </div>

        </div>

<!-- =========================
     EXECUTOR DE C√ìDIGO (MODO MANUAL)
========================== -->
<div
  id="codeExecutorCard"
  style="
    display: none;
    flex: 1;
    padding: 24px;
    background: #0f1115;
  "
>
  <div
    style="
      border: 1px solid #1e2230;
      border-radius: 14px;
      background: linear-gradient(180deg, #12151c, #0f1115);
      padding: 22px;
      max-width: 900px;
      margin: 0 auto;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.02),
                  0 12px 30px rgba(0,0,0,0.45);
    "
  >

    <!-- T√çTULO -->
    <div style="margin-bottom: 14px;">
      <div style="font-size: 16px; font-weight: 600;">
        üß™ Executor de C√≥digo ‚Äî Modo Manual
      </div>
      <div style="font-size: 13px; color: #9aa0a6; margin-top: 4px;">
        Canal isolado para diagnose, dry-run, apply e rollback via DigitalOcean.
      </div>
    </div>

    <!-- TEXTO EXPLICATIVO -->
    <div
      style="
        margin-bottom: 14px;
        font-size: 12px;
        color: #6f7785;
      "
    >
      Este canal √© totalmente independente do fluxo de deploy do Worker e do Executor de Browser.
    </div>

    <!-- EXECUTOR DE C√ìDIGO (DO) -->
    <div
      id="codeExecutorPanel"
      style="
        border: 1px dashed #1e2230;
        border-radius: 10px;
        padding: 14px;
        margin-bottom: 18px;
        background: #0c0f15;
      "
    >
      <div style="font-size: 14px; font-weight: 500; margin-bottom: 10px;">
        Executor de C√≥digo (DigitalOcean)
      </div>

      <div class="executor-actions">
        <button id="codeDiagnoseBtn">Diagnose</button>
        <button id="codeDryRunBtn">Dry Run</button>
        <button id="codeApplyBtn" disabled>Aplicar</button>
        <button id="codeRollbackBtn" disabled>Rollback</button>
      </div>

  <div class="executor-actions executor-actions-secondary">
  <button class="executor-btn-secondary">Hist√≥rico</button>
  <button class="executor-btn-secondary">Telemetria</button>

  <!-- EXECUTAR BROWSER (FIXO ‚Äî SOMENTE MODO MANUAL) -->
  <button
    id="browser-execute-btn"
    class="executor-btn-secondary"
    disabled
    >
    Executar Browser
  </button>
</div>

      <pre
        id="codeExecutorOutput"
        style="
          background: #0f1115;
          border: 1px solid #1e2230;
          border-radius: 8px;
          padding: 12px;
          font-size: 12px;
          color: #e8eaed;
          max-height: 240px;
          overflow: auto;
        "
      ></pre>
    </div>

    <!-- INPUT HUMANO -->
    <textarea
      id="humanBrowserPlan"
      data-field="human-browser-plan"
      placeholder="Cole aqui o patch ou instru√ß√£o t√©cnica para diagnose / dry-run"
      style="
        width: 100%;
        min-height: 220px;
        background: #0f1115;
        color: #ffffff;
        border: 1px solid #1e2230;
        border-radius: 10px;
        padding: 14px;
        font-family: monospace;
        font-size: 13px;
        line-height: 1.5;
      "
    ></textarea>

    <div
      style="
        margin-top: 10px;
        font-size: 12px;
        color: #6f7785;
      "
    >
      Nenhuma execu√ß√£o ocorre sem a√ß√£o humana expl√≠cita.
    </div>

  </div>
</div>

                <!-- =========================
             PAINEL DE BOT√ïES (DIREITA)
        ========================== -->
        <aside class="actions-panel">

          <div class="actions-header">
            Fluxo de Deploy
          </div>

          <!-- =========================
               DEPLOY INPUTS (CAN√îNICO)
               ‚úÖ exclusivo do fluxo de deploy
               ‚ùå n√£o tem nada a ver com browser executor
          ========================== -->
          <div style="margin: 12px 0; padding: 12px; border: 1px solid #1e2230; border-radius: 10px; background:#0c0f15;">
            <div style="font-size: 12px; color:#9aa0a6; margin-bottom:8px;">
              Deploy ‚Äî Patch + Target
            </div>

            <input
              id="targetWorkerIdInput"
              placeholder="target.workerId (ex: nv-enavia)"
              style="width:100%; padding:10px; border-radius:10px; border:1px solid #1e2230; background:#0f1115; color:#fff; margin-bottom:10px; font-family: monospace; font-size: 13px;"
            />

            <textarea
              id="patchTextarea"
              placeholder="PATCH (DEPLOY) ‚Äî cole aqui o patch"
              style="width:100%; min-height:140px; padding:12px; border-radius:10px; border:1px solid #1e2230; background:#0f1115; color:#fff; font-family:monospace; font-size:13px; line-height:1.5;"
            ></textarea>
          </div>

          <button class="action-btn disabled" data-action="audit">
            AUDIT
          </button>

          <button class="action-btn disabled" data-action="propose">
            PROPOSE
          </button>

          <button class="action-btn disabled" data-action="apply-test">
            APPLY TEST
          </button>

          <button class="action-btn disabled" data-action="deploy-test">
            DEPLOY TESTE
          </button>

          <button class="action-btn disabled" data-action="approve">
            APPROVE
          </button>

          <button class="action-btn disabled" data-action="promote-real">
            PROMOTE REAL
          </button>

          <div class="divider"></div>

          <button class="action-btn danger disabled" data-action="rollback">
            ROLLBACK
          </button>

          <button class="action-btn secondary" data-action="cancel">
            CANCELAR
          </button>

          <!-- üî¥ AO VIVO -->
<div class="divider live-divider"></div>

<button class="action-btn live-btn" id="liveViewBtn">
  üî¥ AO VIVO
</button>

        </aside>

      </section>

      <!-- =========================
           ALERTA CENTRAL
      ========================== -->
      <div class="center-alert hidden" id="centerAlert">
        <div class="alert-box">
          <div class="alert-title">‚ö†Ô∏è A√ß√£o bloqueada</div>
          <div class="alert-text" id="centerAlertText">
            Esta a√ß√£o ainda n√£o est√° dispon√≠vel no fluxo atual.
          </div>
        </div>
      </div>

    </main>

  </div>

  <!-- üîó EXECUTOR (CONFIGURA√á√ÉO GLOBAL) -->
<script>
  window.RUN_ADAPTER_URL = "https://run.nv-imoveis.com";
  window.BROWSER_EXECUTOR_URL = "https://run.nv-imoveis.com";
</script>

<!-- üîó CLIENTE DO EXECUTOR (FRONTEND PURO) -->
<!-- <script src="./browser-executor.js"></script> -->

  <!-- ‚úÖ SCRIPT PRINCIPAL (OBRIGAT√ìRIO PARA VERCEL) -->
  <script type="module" src="./script.js"></script>

  <script type="module" src="./lib/browser-executor-ui.js"></script>

</body>
</html>
